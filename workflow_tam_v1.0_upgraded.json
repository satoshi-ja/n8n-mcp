{
  "name": "tamç‰ˆ_ã‚«ãƒ•ã‚§ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’slackã«è‡ªå‹•æŠ•ç¨¿ v1.0 (v1.1æ©Ÿèƒ½è¿½åŠ ç‰ˆ)",
  "nodes": [
    {
      "parameters": {
        "path": "cafe-menu-form-webhook",
        "formTitle": "ã‚«ãƒ•ã‚§ãƒ¡ãƒ‹ãƒ¥ãƒ¼å‘ŠçŸ¥ãƒ•ã‚©ãƒ¼ãƒ ",
        "formDescription": "å†™çœŸã¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼åã‚’å…¥åŠ›ã™ã‚‹ã ã‘ã§ã€ãƒ—ãƒ­ç´šã®ã‚«ãƒ•ã‚§å‘ŠçŸ¥ãŒç¬æ™‚ã«å®Œæˆï¼",
        "formFields": {
          "values": [
            {
              "fieldLabel": "ãƒ¡ãƒ‹ãƒ¥ãƒ¼å",
              "requiredField": true
            },
            {
              "fieldLabel": "ã‚«ãƒ†ã‚´ãƒª",
              "fieldType": "dropdown",
              "fieldOptions": {
                "values": [
                  {"option": "ã‚³ãƒ¼ãƒ’ãƒ¼ â˜•"},
                  {"option": "ãƒ‰ãƒªãƒ³ã‚¯ğŸ¹"},
                  {"option": "ã‚¹ã‚¤ãƒ¼ãƒ„ ğŸ§"},
                  {"option": "ãƒ©ãƒ³ãƒğŸ"},
                  {"option": "BARğŸº"}
                ]
              },
              "requiredField": true
            },
            {
              "fieldLabel": "å†™çœŸ",
              "fieldType": "file",
              "multipleFiles": false,
              "acceptFileTypes": ".jpg,.jpeg,.png",
              "requiredField": true
            },
            {
              "fieldLabel": "å ´æ‰€",
              "requiredField": true
            },
            {
              "fieldLabel": "æä¾›æ™‚é–“",
              "requiredField": true
            },
            {
              "fieldLabel": "ç‰¹åˆ¥ãªèª¬æ˜",
              "fieldType": "textarea",
              "requiredField": "={{ false }}"
            }
          ]
        },
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "form-trigger",
      "name": "Form Trigger",
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.1,
      "position": [0, 0]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.anthropic.com/v1/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "anthropicApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"claude-3-5-sonnet-20241022\",\n  \"max_tokens\": 300,\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": [\n        {\n          \"type\": \"text\",\n          \"text\": \"ã“ã®ç”»åƒã‚’è¦‹ã¦ã€æ–™ç†ã‚„é£²ã¿ç‰©ã®ç‰¹å¾´ã‚’è©³ã—ãèª¬æ˜ã—ã¦ãã ã•ã„ã€‚è‰²åˆã„ã€ç››ã‚Šä»˜ã‘ã€é›°å›²æ°—ãªã©ã‚’å«ã‚ã¦ã€é­…åŠ›çš„ã«æå†™ã—ã¦ãã ã•ã„ã€‚\"\n        },\n        {\n          \"type\": \"image\",\n          \"source\": {\n            \"type\": \"base64\",\n            \"media_type\": \"{{ $binary.data.mimeType }}\",\n            \"data\": \"{{ $binary.data.data }}\"\n          }\n        }\n      ]\n    }\n  ]\n}",
        "options": {}
      },
      "id": "image-analysis",
      "name": "ç”»åƒè§£æ (Claude Vision)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [400, 0]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.anthropic.com/v1/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "anthropicApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"claude-3-5-sonnet-20241022\",\n  \"max_tokens\": 100,\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": \"{{ $('Form Trigger').item.json.ãƒ¡ãƒ‹ãƒ¥ãƒ¼å }}ã¨ã„ã†{{ $('Form Trigger').item.json.ã‚«ãƒ†ã‚´ãƒª }}ã®æ–™ç†ã«ã¤ã„ã¦ã€ã‚«ãƒ•ã‚§ã®å®£ä¼ç”¨ã«é­…åŠ›çš„ã§çŸ­ã„ã‚­ãƒ£ãƒƒãƒãƒ•ãƒ¬ãƒ¼ã‚ºã‚’ä¸€ã¤ã ã‘ä½œã£ã¦ãã ã•ã„ã€‚å‰ç½®ãã‚„èª¬æ˜ã¯ä¸è¦ã§ã€ã‚­ãƒ£ãƒƒãƒãƒ•ãƒ¬ãƒ¼ã‚ºã®ã¿ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚\\n\\nç”»åƒåˆ†æçµæœï¼š{{ $('ç”»åƒè§£æ (Claude Vision)').item.json.content[0].text }}\"\n    }\n  ]\n}",
        "options": {}
      },
      "id": "catchphrase-generation",
      "name": "ã‚­ãƒ£ãƒƒãƒãƒ•ãƒ¬ãƒ¼ã‚ºç”Ÿæˆ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [608, 0]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.anthropic.com/v1/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "anthropicApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"claude-3-5-sonnet-20241022\",\n  \"max_tokens\": 200,\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": \"ã‚«ãƒ•ã‚§ã®Slackå‘ŠçŸ¥ç”¨ã«ã€{{ $('Form Trigger').item.json.ãƒ¡ãƒ‹ãƒ¥ãƒ¼å }}ã«ã¤ã„ã¦ã®é­…åŠ›çš„ãªèª¬æ˜æ–‡ã‚’2ã€œ3æ–‡ã§ä½œæˆã—ã¦ãã ã•ã„ã€‚è³¼è²·æ„æ¬²ã‚’ããã‚‹ã‚ˆã†ãªå†…å®¹ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚\\n\\nãƒ¡ãƒ‹ãƒ¥ãƒ¼åï¼š{{ $('Form Trigger').item.json.ãƒ¡ãƒ‹ãƒ¥ãƒ¼å }}\\nã‚«ãƒ†ã‚´ãƒªï¼š{{ $('Form Trigger').item.json.ã‚«ãƒ†ã‚´ãƒª }}\\nç”»åƒåˆ†æï¼š{{ $('ç”»åƒè§£æ (Claude Vision)').item.json.content[0].text }}\\nã‚­ãƒ£ãƒƒãƒãƒ•ãƒ¬ãƒ¼ã‚ºï¼š{{ $('ã‚­ãƒ£ãƒƒãƒãƒ•ãƒ¬ãƒ¼ã‚ºç”Ÿæˆ').item.json.content[0].text }}\\n{{ $('Form Trigger').item.json.ç‰¹åˆ¥ãªèª¬æ˜ ? 'ç‰¹åˆ¥ãªèª¬æ˜ï¼š' + $('Form Trigger').item.json.ç‰¹åˆ¥ãªèª¬æ˜ : '' }}\\n\\nå‰ç½®ãã‚„èª¬æ˜ã¯ä¸è¦ã§ã€èª¬æ˜æ–‡ã®ã¿ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚\"\n    }\n  ]\n}",
        "options": {}
      },
      "id": "description-generation",
      "name": "èª¬æ˜æ–‡ç”Ÿæˆ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [800, 0]
    },
    {
      "parameters": {
        "jsCode": "// ãƒ‡ãƒãƒƒã‚°: ã™ã¹ã¦ã®ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª\n  console.log('=== BINARY DATA DEBUG ===');\n  console.log('Form Trigger binary:', $('Form Trigger').item.binary);\n  console.log('Form Trigger binary keys:', $('Form Trigger').item.binary ? Object.keys($('Form Trigger').item.binary) :\n  'No binary');\n  console.log('Input binary:', $input.item.binary);\n  console.log('Input binary keys:', $input.item.binary ? Object.keys($input.item.binary) : 'No binary');\n\n  // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®å–å¾—\n  const formData = $('Form Trigger').item.json;\n\n  // å„ãƒãƒ¼ãƒ‰ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å®‰å…¨ã«å–å¾—ï¼ˆå­˜åœ¨ã—ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨ï¼‰\n  let imageAnalysis = \"ç¾å‘³ã—ãã†ãªæ–™ç†ã®å†™çœŸã§ã™ã€‚\";\n  let catchphrase = \"æœ¬æ—¥ã®ãŠã™ã™ã‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼\";\n  let description = \"ãœã²ãŠè©¦ã—ãã ã•ã„ã€‚\";\n\n  // ç”»åƒè§£æãŒæœ‰åŠ¹ãªå ´åˆ\n  try {\n    const imageAnalysisNode = $('ç”»åƒè§£æ (Claude Vision)');\n    if (imageAnalysisNode && imageAnalysisNode.item && imageAnalysisNode.item.json) {\n      imageAnalysis = imageAnalysisNode.item.json.content[0].text;\n    }\n  } catch (e) {\n    console.log('ç”»åƒè§£æãƒãƒ¼ãƒ‰ãŒç„¡åŠ¹ã¾ãŸã¯ã‚¨ãƒ©ãƒ¼:', e.message);\n  }\n\n  // ã‚­ãƒ£ãƒƒãƒãƒ•ãƒ¬ãƒ¼ã‚ºç”Ÿæˆã®çµæœã‚’å–å¾—\n  try {\n    const catchphraseNode = $('ã‚­ãƒ£ãƒƒãƒãƒ•ãƒ¬ãƒ¼ã‚ºç”Ÿæˆ');\n    if (catchphraseNode && catchphraseNode.item && catchphraseNode.item.json) {\n      catchphrase = catchphraseNode.item.json.content[0].text;\n    }\n  } catch (e) {\n    console.log('ã‚­ãƒ£ãƒƒãƒãƒ•ãƒ¬ãƒ¼ã‚ºç”Ÿæˆãƒãƒ¼ãƒ‰ã®ã‚¨ãƒ©ãƒ¼:', e.message);\n  }\n\n  // èª¬æ˜æ–‡ç”Ÿæˆã®çµæœã‚’å–å¾—\n  try {\n    const descriptionNode = $('èª¬æ˜æ–‡ç”Ÿæˆ');\n    if (descriptionNode && descriptionNode.item && descriptionNode.item.json) {\n      description = descriptionNode.item.json.content[0].text;\n    }\n  } catch (e) {\n    console.log('èª¬æ˜æ–‡ç”Ÿæˆãƒãƒ¼ãƒ‰ã®ã‚¨ãƒ©ãƒ¼:', e.message);\n  }\n\n  // ã‚«ãƒ†ã‚´ãƒªã«å¿œã˜ãŸè£…é£¾ã®é¸æŠ\n  let decoration = {};\n  switch(formData.ã‚«ãƒ†ã‚´ãƒª) {\n    case 'ã‚³ãƒ¼ãƒ’ãƒ¼ â˜•':\n      decoration = {\n        mainEmoji: 'â˜•',\n        subEmojis: ['âœ¨', 'â­'],\n        borderStyle: 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'\n      };\n      break;\n    case 'ãƒ‰ãƒªãƒ³ã‚¯ğŸ¹':\n      decoration = {\n        mainEmoji: 'ğŸ¹',\n        subEmojis: ['ğŸŒ´', 'ğŸŒŠ'],\n        borderStyle: 'ã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œ'\n      };\n      break;\n    case 'ã‚¹ã‚¤ãƒ¼ãƒ„ ğŸ§':\n      decoration = {\n        mainEmoji: 'ğŸ§',\n        subEmojis: ['ğŸ‰', 'ğŸ’•'],\n        borderStyle: 'ğŸŒˆ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸŒˆ'\n      };\n      break;\n    case 'ãƒ©ãƒ³ãƒğŸ':\n      decoration = {\n        mainEmoji: 'ğŸ',\n        subEmojis: ['ğŸŒ¿', 'ğŸ¥—'],\n        borderStyle: 'â—†â—‡â—†â—‡â—†â—‡â—†â—‡â—†â—‡â—†â—‡â—†â—‡â—†'\n      };\n      break;\n    case 'BARğŸº':\n      decoration = {\n        mainEmoji: 'ğŸº',\n        subEmojis: ['ğŸ†', 'ğŸŒ™'],\n        borderStyle: 'â˜…â˜†â˜…â˜†â˜…â˜†â˜…â˜†â˜…â˜†â˜…â˜†â˜…'\n      };\n      break;\n    default:\n      decoration = {\n        mainEmoji: 'ğŸ´',\n        subEmojis: ['âœ¨', 'â­'],\n        borderStyle: 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'\n      };\n  }\n\n  // ç¾åœ¨æ™‚åˆ»ã®å–å¾—\n  const now = new Date();\n  const hours = now.getHours();\n  let timeGreeting = '';\n  if (hours < 12) {\n    timeGreeting = 'ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ï¼æœã®';\n  } else if (hours < 17) {\n    timeGreeting = 'ã“ã‚“ã«ã¡ã¯ï¼åˆå¾Œã®';\n  } else {\n    timeGreeting = 'ãŠç–²ã‚Œæ§˜ã§ã™ï¼å¤•æ–¹ã®';\n  }\n\n  // SlackæŠ•ç¨¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®çµ„ã¿ç«‹ã¦ (Slackã®ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—å½¢å¼)\n  const slackMessage = `\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚  ${decoration.mainEmoji} æœ¬æ—¥ã®Special ${decoration.mainEmoji}  â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n  ${decoration.subEmojis[0]} *${catchphrase}* ${decoration.subEmojis[0]}\n\n  ${description}\n\n  ${decoration.borderStyle}\n  ğŸ“ å ´æ‰€: ${formData.å ´æ‰€}\n  â° æä¾›æ™‚é–“: ${formData.æä¾›æ™‚é–“}\n  ${decoration.borderStyle}\n\n  ğŸ¯ ${timeGreeting}ã²ã¨ã¨ãã€\n  ${decoration.mainEmoji} ã§ã»ã£ã¨ä¸€æ¯ã¤ãã¾ã›ã‚“ã‹ï¼Ÿ\n\n  #tam and co. #ä»Šæ—¥ã®ã‚ªã‚¹ã‚¹ãƒ¡ #${formData.ã‚«ãƒ†ã‚´ãƒª.replace(' ', '')}\n  `;\n\n  // Form Triggerã‹ã‚‰ç›´æ¥ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\n  const originalBinary = $('Form Trigger').item.binary;\n\n  // ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ¼åã‚’çµ±ä¸€ï¼ˆé‡è¦ï¼ï¼‰\n  let normalizedBinary = {};\n  if (originalBinary && Object.keys(originalBinary).length > 0) {\n    const firstKey = Object.keys(originalBinary)[0];\n    console.log('Original binary key:', firstKey);\n    normalizedBinary = { data: originalBinary[firstKey] };\n  } else if ($input.item.binary && Object.keys($input.item.binary).length > 0) {\n    const firstKey = Object.keys($input.item.binary)[0];\n    console.log('Input binary key:', firstKey);\n    normalizedBinary = { data: $input.item.binary[firstKey] };\n  }\n\n  console.log('Normalized binary:', normalizedBinary);\n\n  // çµæœã‚’è¿”ã™ï¼ˆãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã‚‚å«ã‚ã‚‹ï¼‰\n  return {\n    json: {\n      slackMessage: slackMessage,\n      menuName: formData.ãƒ¡ãƒ‹ãƒ¥ãƒ¼å,\n      category: formData.ã‚«ãƒ†ã‚´ãƒª,\n      decoration: decoration\n    },\n    // ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã‚’'data'ã¨ã„ã†ã‚­ãƒ¼åã§ç¢ºå®Ÿã«æ¸¡ã™\n    binary: normalizedBinary\n  };"
      },
      "id": "slack-post-builder",
      "name": "SlackæŠ•ç¨¿æ§‹ç¯‰",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1008, 0]
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C096CHYL9U2",
          "mode": "list",
          "cachedResultName": "tam-and-co"
        },
        "text": "={{ $json.slackMessage }}",
        "otherOptions": {}
      },
      "id": "slack-post",
      "name": "SlackæŠ•ç¨¿",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.2,
      "position": [1200, 0]
    },
    {
      "parameters": {
        "resource": "file",
        "options": {
          "channelId": "C096CHYL9U2",
          "binaryPropertyName": "data"
        }
      },
      "id": "photo-upload",
      "name": "å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.2,
      "position": [1200, 208],
      "continueOnFail": true
    }
  ],
  "connections": {
    "Form Trigger": {
      "main": [
        [
          {
            "node": "ç”»åƒè§£æ (Claude Vision)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ç”»åƒè§£æ (Claude Vision)": {
      "main": [
        [
          {
            "node": "ã‚­ãƒ£ãƒƒãƒãƒ•ãƒ¬ãƒ¼ã‚ºç”Ÿæˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚­ãƒ£ãƒƒãƒãƒ•ãƒ¬ãƒ¼ã‚ºç”Ÿæˆ": {
      "main": [
        [
          {
            "node": "èª¬æ˜æ–‡ç”Ÿæˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "èª¬æ˜æ–‡ç”Ÿæˆ": {
      "main": [
        [
          {
            "node": "SlackæŠ•ç¨¿æ§‹ç¯‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SlackæŠ•ç¨¿æ§‹ç¯‰": {
      "main": [
        [
          {
            "node": "SlackæŠ•ç¨¿",
            "type": "main",
            "index": 0
          },
          {
            "node": "å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  }
}